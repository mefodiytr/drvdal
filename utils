package uk.co.controlnetworksolutions.elitedali2.utils;

import javax.baja.driver.BDevice;
import javax.baja.driver.BDeviceNetwork;
import javax.baja.license.Feature;
import javax.baja.license.FeatureNotLicensedException;
import javax.baja.license.LicenseException;
import javax.baja.status.BStatus;
import javax.baja.sys.Sys;

public class CnsLicense {
   private static final String CNS_LICENSE_VENDOR = "cns";
   private static final String CNS_LICENSE_DIM_FEATURE = "dim2";
   private static final String CNS_LICENSE_DIM_PER_PORT_LIMIT = "dimperport.limit";
   private static final String CNS_LICENSE_DIM_ERROR = "This elitedali software is not licensed to run on this host";
   private static final int DEFAULT_DIM_DEVICE_LIMIT = 2;

   public static synchronized int checkDimLicense(BDeviceNetwork var0) {
      Feature var1;
      try {
         var1 = Sys.getLicenseManager().checkFeature("cns", "dim2");
      } catch (FeatureNotLicensedException var3) {
         var1 = null;
      }

      if (var1 != null && var1.isExpired()) {
         var1 = null;
      }

      if (var1 == null) {
         Report.dim.error("This elitedali software is not licensed to run on this host");
         var0.configFatal("This elitedali software is not licensed to run on this host");
         var0.pingFail("This elitedali software is not licensed to run on this host");
         throw new LicenseException("This elitedali software is not licensed to run on this host");
      } else {
         return var1.geti("dimperport.limit", 2);
      }
   }

   public static synchronized boolean checkDeviceLicense(String var0, String var1, String var2, int var3, BDevice var4) {
      boolean var9 = false;

      Feature var5;
      try {
         var5 = Sys.getLicenseManager().getFeature("cns", var0);
      } catch (FeatureNotLicensedException var11) {
         var5 = null;
      }

      String var6 = "This CNS elitedali system is not licensed to use the " + var2 + " device";
      if (var5 == null) {
         var4.setStatus(BStatus.fault);
         var4.setFaultCause(var6);
         var4.configFatal(var2 + " device not licensed");
         var4.pingFail(var6);
         throw new LicenseException(var6);
      } else {
         String var7 = var5.get(var1);
         if (var7 == null) {
            var4.setStatus(BStatus.fault);
            var4.setFaultCause(var6);
            var4.configFatal(var2 + " device not licensed");
            var4.pingFail(var6);
            throw new LicenseException(var6);
         } else {
            if (var7.equalsIgnoreCase("none")) {
               var9 = true;
            } else {
               int var8 = var5.geti(var1, 0);
               if (var3 > var8) {
                  var6 = "CNS elitedali " + var2 + " device count (" + var3 + ") exceeds license limit (" + var8 + ')';
                  var4.setStatus(BStatus.fault);
                  var4.setFaultCause(var6);
                  var4.configFatal(var2 + " device license exceeded");
                  var4.pingFail(var6);
                  throw new LicenseException(var6);
               }

               var9 = true;
            }

            return var9;
         }
      }
   }
}
package uk.co.controlnetworksolutions.elitedali2.utils;

import javax.baja.sys.BModule;
import javax.baja.sys.BObject;
import javax.baja.sys.Sys;
import javax.baja.util.Version;

public class CnsVersionUtil {
   public static String getModuleVersion(BObject var0) {
      BModule var1 = Sys.getModuleForClass(var0.getType().getTypeClass());
      if (var1 != null) {
         Version var2 = var1.getVendorVersion();
         if (var2 != null) {
            return var2.toString();
         }
      }

      return "unknown";
   }
}
package uk.co.controlnetworksolutions.elitedali2.utils;

import javax.baja.util.Lexicon;

public final class Lex {
   public static final Lexicon moduleLexicon = Lexicon.make("elitedali2");

   public static final String getText(String var0) {
      return moduleLexicon.getText(var0);
   }

   public static final Lexicon getLexicon() {
      return moduleLexicon;
   }
}
package uk.co.controlnetworksolutions.elitedali2.utils;

import javax.baja.log.Log;

public final class Report {
   public static final Log dim = Log.getLog("elitedali2.dim");
   public static final Log daliAddressing = Log.getLog("elitedali2.dali.addressing");
   public static final Log daliDevice = Log.getLog("elitedali2.dali.dev");
   public static final Log daliNetwork = Log.getLog("elitedali2.dali.net");
}
package uk.co.controlnetworksolutions.elitedali2.utils;

import java.text.NumberFormat;

public final class StrUtil {
   public static final String byteToBinary(byte var0) {
      return byteToBinary(255 & var0);
   }

   public static final String byteToBinary(int var0) {
      String var1 = "0000000000" + Integer.toBinaryString(var0);
      return var1.substring(var1.length() - 8, var1.length());
   }

   public static final String dataToHex(byte[] var0) {
      return dataToHex(var0, "/");
   }

   public static final String dataToHex(byte[] var0, String var1) {
      String var2 = "";
      if (var0 != null) {
         for(int var3 = 0; var3 < var0.length; ++var3) {
            if (var3 != 0) {
               var2 = var2 + var1;
            }

            var2 = var2 + paddedHex(255 & var0[var3], 2);
         }
      } else {
         var2 = "null";
      }

      return var2;
   }

   public static final String paddedHex(int var0) {
      return paddedHex((byte)var0, 2);
   }

   public static final String paddedHex(byte var0) {
      return paddedHex(var0, 2);
   }

   public static final String paddedHex(long var0, int var2) {
      return paddedStr(Long.toHexString(var0).toUpperCase(), var2);
   }

   public static final String paddedHex(int var0, int var1) {
      return paddedStr(Integer.toHexString(var0).toUpperCase(), var1);
   }

   public static final String paddedStr(String var0, int var1) {
      String var2 = "0000000000" + var0;
      return var2.substring(var2.length() - var1, var2.length());
   }

   public static final String numberFormat2(double var0) {
      NumberFormat var2 = NumberFormat.getInstance();
      var2.setMaximumFractionDigits(2);
      return var2.format(var0);
   }
}
